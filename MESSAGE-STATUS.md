# üì® –°—Ç–∞—Ç—É—Å—ã —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Chatroulette Backend

## ‚úÖ **–ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:**

### **üìä –°—Ç–∞—Ç—É—Å—ã —Å–æ–æ–±—â–µ–Ω–∏–π:**
- **sent** - –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- **delivered** - –î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ
- **read** - –ü—Ä–æ—á–∏—Ç–∞–Ω–æ
- **edited** - –ò–∑–º–µ–Ω–µ–Ω–æ
- **deleted** - –£–¥–∞–ª–µ–Ω–æ

### **üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:**
- **IsEdited** - –§–ª–∞–≥ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **EditedAt** - –í—Ä–µ–º—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **ReadAt** - –í—Ä–µ–º—è –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–æ—á—Ç–µ–Ω–∏—è
- **ReadBy** - –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø—Ä–æ—á–∏—Ç–∞–≤—à–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–µ

## üöÄ **API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏:**

### **1. –û—Ç–º–µ—Ç–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ:**
```bash
PUT /api/v1/messages/{message_id}/read
Authorization: Bearer {token}

# –û—Ç–≤–µ—Ç:
{
  "message_id": "uuid",
  "status": "read",
  "status_text": "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ",
  "read_by": ["user1", "user2"],
  "read_at": "2025-10-03T10:00:00Z"
}
```

### **2. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ:**
```bash
PUT /api/v1/messages/{message_id}/edit
Authorization: Bearer {token}
Content-Type: application/json

{
  "content": "–ù–æ–≤—ã–π —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è"
}

# –û—Ç–≤–µ—Ç:
{
  "id": "uuid",
  "content": "–ù–æ–≤—ã–π —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è",
  "status": "edited",
  "is_edited": true,
  "edited_at": "2025-10-03T10:00:00Z"
}
```

### **3. –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–æ–æ–±—â–µ–Ω–∏—è:**
```bash
GET /api/v1/messages/{message_id}/status
Authorization: Bearer {token}

# –û—Ç–≤–µ—Ç:
{
  "message_id": "uuid",
  "status": "read",
  "status_text": "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ",
  "is_edited": false,
  "edited_at": null,
  "read_at": "2025-10-03T10:00:00Z",
  "read_by": ["user1", "user2"],
  "created_at": "2025-10-03T09:00:00Z",
  "updated_at": "2025-10-03T10:00:00Z"
}
```

## üì± **WebSocket —Å–æ–±—ã—Ç–∏—è:**

### **1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–æ–æ–±—â–µ–Ω–∏—è:**
```json
{
  "type": "message_status_update",
  "chat_id": "chat_uuid",
  "payload": {
    "message_id": "message_uuid",
    "status": "read",
    "read_by": ["user1", "user2"],
    "read_at": "2025-10-03T10:00:00Z"
  }
}
```

### **2. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è:**
```json
{
  "type": "message_edited",
  "chat_id": "chat_uuid",
  "payload": {
    "id": "message_uuid",
    "content": "–ù–æ–≤—ã–π —Ç–µ–∫—Å—Ç",
    "status": "edited",
    "is_edited": true,
    "edited_at": "2025-10-03T10:00:00Z"
  }
}
```

## üîÑ **–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Å–æ–æ–±—â–µ–Ω–∏—è:**

### **1. –û—Ç–ø—Ä–∞–≤–∫–∞:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç ‚Üí Status: "sent"
```

### **2. –î–æ—Å—Ç–∞–≤–∫–∞:**
```
–°–µ—Ä–≤–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç ‚Üí Status: "delivered"
```

### **3. –ü—Ä–æ—á—Ç–µ–Ω–∏–µ:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —á–∏—Ç–∞–µ—Ç ‚Üí Status: "read"
```

### **4. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```
–ê–≤—Ç–æ—Ä —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç ‚Üí Status: "edited"
```

### **5. –£–¥–∞–ª–µ–Ω–∏–µ:**
```
–ê–≤—Ç–æ—Ä —É–¥–∞–ª—è–µ—Ç ‚Üí Status: "deleted"
```

## üíª **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ:**

### **JavaScript - –û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ:**
```javascript
async function markAsRead(messageId) {
    const response = await fetch(`/api/v1/messages/${messageId}/read`, {
        method: 'PUT',
        headers: {
            'Authorization': 'Bearer ' + token
        }
    });
    
    const result = await response.json();
    console.log('Message marked as read:', result);
}
```

### **JavaScript - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ:**
```javascript
async function editMessage(messageId, newContent) {
    const response = await fetch(`/api/v1/messages/${messageId}/edit`, {
        method: 'PUT',
        headers: {
            'Authorization': 'Bearer ' + token,
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            content: newContent
        })
    });
    
    const result = await response.json();
    console.log('Message edited:', result);
}
```

### **JavaScript - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞:**
```javascript
function displayMessageStatus(message) {
    const statusIcons = {
        'sent': 'üì§',
        'delivered': 'üì®',
        'read': '‚úÖ',
        'edited': '‚úèÔ∏è',
        'deleted': 'üóëÔ∏è'
    };
    
    const statusText = {
        'sent': '–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ',
        'delivered': '–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ',
        'read': '–ü—Ä–æ—á–∏—Ç–∞–Ω–æ',
        'edited': '–ò–∑–º–µ–Ω–µ–Ω–æ',
        'deleted': '–£–¥–∞–ª–µ–Ω–æ'
    };
    
    return `
        <div class="message-status">
            <span class="status-icon">${statusIcons[message.status]}</span>
            <span class="status-text">${statusText[message.status]}</span>
            ${message.is_edited ? '<span class="edited-badge">(–∏–∑–º–µ–Ω–µ–Ω–æ)</span>' : ''}
        </div>
    `;
}
```

### **JavaScript - WebSocket –æ–±—Ä–∞–±–æ—Ç–∫–∞:**
```javascript
ws.onmessage = function(event) {
    const data = JSON.parse(event.data);
    
    switch(data.type) {
        case 'message_status_update':
            updateMessageStatus(data.payload);
            break;
        case 'message_edited':
            updateMessageContent(data.payload);
            break;
    }
};

function updateMessageStatus(payload) {
    const messageElement = document.querySelector(`[data-message-id="${payload.message_id}"]`);
    if (messageElement) {
        const statusElement = messageElement.querySelector('.message-status');
        statusElement.innerHTML = displayMessageStatus(payload);
    }
}
```

## üéØ **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

### **1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ç–∞—Ç—É—Å—ã:**
- **–û—Ç–ø—Ä–∞–≤–∫–∞:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è "sent"
- **–î–æ—Å—Ç–∞–≤–∫–∞:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ "delivered"
- **–ü—Ä–æ—á—Ç–µ–Ω–∏–µ:** –¢—Ä–µ–±—É–µ—Ç —è–≤–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ API

### **2. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- ‚úÖ **–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –¢–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä –º–æ–∂–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
- ‚úÖ **–ü—Ä–æ—á—Ç–µ–Ω–∏–µ:** –¢–æ–ª—å–∫–æ —É—á–∞—Å—Ç–Ω–∏–∫–∏ —á–∞—Ç–∞ –º–æ–≥—É—Ç –æ—Ç–º–µ—á–∞—Ç—å –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω–æ–µ
- ‚úÖ **–î–æ—Å—Ç—É–ø:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ —á–∞—Ç—É

### **3. –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ:**
- **ReadBy:** –ú–∞—Å—Å–∏–≤ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø—Ä–æ—á–∏—Ç–∞–≤—à–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–µ
- **ReadAt:** –í—Ä–µ–º—è –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–æ—á—Ç–µ–Ω–∏—è
- **EditedAt:** –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## üöÄ **–í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:**

### **1. –ì—Ä—É–ø–ø–æ–≤—ã–µ —á–∞—Ç—ã:**
- **–í—Å–µ –ø—Ä–æ—á–∏—Ç–∞–ª–∏:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
- **–ö—Ç–æ –ø—Ä–æ—á–∏—Ç–∞–ª:** –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø—Ä–æ—á–∏—Ç–∞–≤—à–∏—Ö
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:** Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–æ—á—Ç–µ–Ω–∏–∏

### **2. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã:**
- **typing** - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—á–∞—Ç–∞–µ—Ç
- **sending** - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è
- **failed** - –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏

### **3. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞:**
- **–í—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏:** –ú–µ—Ç—Ä–∏–∫–∏ —Å–∫–æ—Ä–æ—Å—Ç–∏
- **–ü—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–æ—á—Ç–µ–Ω–∏—è:** –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —á–∞—Ç–∞–º
- **–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:** –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## ‚úÖ **–ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:**

**–°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞!**
- üéØ **–í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è**
- üîÑ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ WebSocket**
- üõ°Ô∏è **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤**
- üì± **–ì–æ—Ç–æ–≤–æ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π**

**–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è!** üì®‚ú®
